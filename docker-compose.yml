version: '3.8'

services:
  device:
    build: .
    platform: linux/arm64  # Platform specification to match Dockerfile
    ports:
      - "5050:5050"
    environment:
      - FLASK_ENV=development
      - WEB3_PROVIDER=http://host.docker.internal:8545
      - WEB3_WS_PROVIDER=ws://host.docker.internal:8545
      - IPFS_API=/dns/host.docker.internal/tcp/5001/http # ipfshttpclient 연결용
      - IPFS_GATEWAY=http://host.docker.internal:8080     # 게이트웨이 다운로드용
      - MANUFACTURER_API_URL=http://blocker_manufacturer_backend:5002
      - DEVICE_API_PORT=5050
      - CP_ABE_DEBUG=1  # Enable CP-ABE debug logging
      - TORCH_CPP_LOG_LEVEL=ERROR
      - DBUS_SESSION_BUS_ADDRESS=/dev/null
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./client/keys:/app/client/keys
      - ./data:/app/data
      # - /home/soda/Blocker/sy:/app/client/updates # 업데이트 파일을 /soda/Blocker에 저장
      - ./client/updates:/app/client/updates   # 업데이트 파일을 client/updates 디렉토리에 저장
    networks:
      - app-network-device

networks:
  app-network-device:
    driver: bridge