version: '3.8'

services:
  device:
    build: .
    platform: linux/amd64  # Platform specification to match Dockerfile
    ports:
      - "5002:5002"
    environment:
      - FLASK_ENV=development
      - WEB3_PROVIDER=http://52.78.52.216:8545
      - WEB3_WS_PROVIDER=ws://52.78.52.216:8545
      - IPFS_API=/dns4/ipfs/tcp/5001/http
      - MANUFACTURER_API_URL=http://host.docker.internal:5001
      - DEVICE_API_PORT=5002
      - CP_ABE_DEBUG=1  # Enable CP-ABE debug logging
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./client/keys:/app/client/keys
      - ./client/updates:/app/client/updates